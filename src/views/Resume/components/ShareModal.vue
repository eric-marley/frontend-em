<template>
  <transition name="modal-fade">
    <div class="share-wrapper">
      <div class="share-modal">
        <span class="message" v-html="message" />
        <span class="link" v-html="link" />
        <button @click="handleCopy" class="copy-button" v-if="!isCopying">
          {{ button }}
          <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6.99023 5.12988C6.73633 5.12988 6.49219 5.17871 6.25781 5.27637C6.0332 5.37402 5.83789 5.50586 5.67188 5.67188C5.50586 5.84766 5.36914 6.04785 5.26172 6.27246C5.16406 6.49707 5.11523 6.74121 5.11523 7.00488V12.6299C5.11523 12.8838 5.16406 13.1279 5.26172 13.3623C5.35938 13.5869 5.49609 13.7822 5.67188 13.9482C5.83789 14.1143 6.0332 14.2461 6.25781 14.3438C6.49219 14.4512 6.73633 14.5049 6.99023 14.5049H12.6152C12.8789 14.5049 13.123 14.4561 13.3477 14.3584C13.582 14.2607 13.7822 14.124 13.9482 13.9482C14.1143 13.7822 14.2461 13.5869 14.3438 13.3623C14.4414 13.1279 14.4902 12.8838 14.4902 12.6299V7.00488C14.4902 6.74121 14.4414 6.49707 14.3438 6.27246C14.2461 6.03809 14.1143 5.83789 13.9482 5.67188C13.7725 5.50586 13.5723 5.37402 13.3477 5.27637C13.123 5.17871 12.8789 5.12988 12.6152 5.12988H6.99023ZM6.99023 6.375H12.6152C12.7031 6.375 12.7861 6.39453 12.8643 6.43359C12.9424 6.46289 13.0059 6.50684 13.0547 6.56543C13.1133 6.61426 13.1572 6.67773 13.1865 6.75586C13.2256 6.83398 13.2451 6.91699 13.2451 7.00488V12.6299C13.2451 12.708 13.2256 12.7861 13.1865 12.8643C13.1572 12.9424 13.1133 13.0107 13.0547 13.0693C13.0059 13.1279 12.9424 13.1719 12.8643 13.2012C12.7861 13.2305 12.7031 13.2451 12.6152 13.2451H6.99023C6.91211 13.2451 6.83398 13.2305 6.75586 13.2012C6.67773 13.1719 6.60938 13.1279 6.55078 13.0693C6.49219 13.0107 6.44824 12.9424 6.41895 12.8643C6.38965 12.7861 6.375 12.708 6.375 12.6299V7.00488C6.375 6.91699 6.38965 6.83398 6.41895 6.75586C6.44824 6.67773 6.49219 6.61426 6.55078 6.56543C6.60938 6.50684 6.67773 6.46289 6.75586 6.43359C6.83398 6.39453 6.91211 6.375 6.99023 6.375ZM3.24023 8.87988H2.625C2.53711 8.87988 2.4541 8.86523 2.37598 8.83594C2.29785 8.79688 2.23438 8.74805 2.18555 8.68945C2.12695 8.63086 2.07812 8.56738 2.03906 8.49902C2.00977 8.4209 1.99512 8.33789 1.99512 8.25V2.625C1.99512 2.53711 2.00977 2.45898 2.03906 2.39062C2.07812 2.3125 2.12695 2.24414 2.18555 2.18555C2.23438 2.12695 2.29785 2.08301 2.37598 2.05371C2.4541 2.01465 2.53711 1.99512 2.625 1.99512H8.25C8.32812 1.99512 8.40625 2.01465 8.48438 2.05371C8.5625 2.08301 8.63086 2.12695 8.68945 2.18555C8.74805 2.24414 8.79199 2.3125 8.82129 2.39062C8.85059 2.45898 8.86523 2.53711 8.86523 2.625V3.25488C8.86523 3.4209 8.92383 3.56738 9.04102 3.69434C9.16797 3.81152 9.31934 3.87012 9.49512 3.87012C9.6709 3.87012 9.81738 3.81152 9.93457 3.69434C10.0615 3.56738 10.125 3.4209 10.125 3.25488V2.625C10.125 2.37109 10.0762 2.13184 9.97852 1.90723C9.88086 1.67285 9.74414 1.47266 9.56836 1.30664C9.40234 1.13086 9.20215 0.994141 8.96777 0.896484C8.74316 0.798828 8.50391 0.75 8.25 0.75H2.625C2.36133 0.75 2.1123 0.798828 1.87793 0.896484C1.65332 0.994141 1.45801 1.13086 1.29199 1.30664C1.12598 1.47266 0.994141 1.67285 0.896484 1.90723C0.798828 2.13184 0.75 2.37109 0.75 2.625V8.25C0.75 8.50391 0.798828 8.74805 0.896484 8.98242C0.994141 9.20703 1.12598 9.40234 1.29199 9.56836C1.46777 9.74414 1.66797 9.88086 1.89258 9.97852C2.11719 10.0762 2.36133 10.125 2.625 10.125H3.24023C3.41602 10.125 3.5625 10.0664 3.67969 9.94922C3.80664 9.82227 3.87012 9.6709 3.87012 9.49512C3.87012 9.3291 3.80664 9.1875 3.67969 9.07031C3.5625 8.94336 3.41602 8.87988 3.24023 8.87988Z" fill="white"/>
          </svg>
        </button>
        <svg @click="handleClosing" class="modal-close-icon" width="23" height="23" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M22.1846 11.1921C22.1846 10.4421 22.1143 9.70776 21.9736 8.98901C21.8174 8.27026 21.5986 7.58276 21.3174 6.92651C21.0518 6.27026 20.7158 5.64526 20.3096 5.05151C19.9189 4.45776 19.4736 3.91089 18.9736 3.41089C18.4736 2.92651 17.9268 2.4812 17.333 2.07495C16.7549 1.68433 16.1377 1.34839 15.4814 1.06714C14.8252 0.785889 14.1377 0.574951 13.4189 0.434326C12.7002 0.278076 11.958 0.199951 11.1924 0.199951C10.4268 0.199951 9.68457 0.278076 8.96582 0.434326C8.24707 0.574951 7.55957 0.785889 6.90332 1.06714C6.24707 1.34839 5.62988 1.68433 5.05176 2.07495C4.45801 2.4812 3.91113 2.92651 3.41113 3.41089C2.91113 3.91089 2.46582 4.45776 2.0752 5.05151C1.66895 5.64526 1.3252 6.27026 1.04395 6.92651C0.77832 7.58276 0.567383 8.27026 0.411133 8.98901C0.270508 9.70776 0.200195 10.4421 0.200195 11.1921C0.200195 11.9578 0.270508 12.7 0.411133 13.4187C0.567383 14.1375 0.77832 14.825 1.04395 15.4812C1.3252 16.1375 1.66895 16.7625 2.0752 17.3562C2.46582 17.9343 2.91113 18.4734 3.41113 18.9734C3.91113 19.4734 4.45801 19.9187 5.05176 20.3093C5.62988 20.7156 6.24707 21.0593 6.90332 21.3406C7.55957 21.6218 8.24707 21.8328 8.96582 21.9734C9.68457 22.1296 10.4268 22.2078 11.1924 22.2078C11.958 22.2078 12.7002 22.1296 13.4189 21.9734C14.1377 21.8328 14.8252 21.6218 15.4814 21.3406C16.1377 21.0593 16.7549 20.7156 17.333 20.3093C17.9268 19.9187 18.4736 19.4734 18.9736 18.9734C19.4736 18.4734 19.9189 17.9343 20.3096 17.3562C20.7158 16.7625 21.0518 16.1375 21.3174 15.4812C21.5986 14.825 21.8174 14.1375 21.9736 13.4187C22.1143 12.7 22.1846 11.9578 22.1846 11.1921ZM20.1924 11.1921C20.1924 12.4421 19.958 13.614 19.4893 14.7078C19.0205 15.8015 18.3799 16.7546 17.5674 17.5671C16.7393 18.3796 15.7783 19.0203 14.6846 19.489C13.6064 19.9578 12.4424 20.1921 11.1924 20.1921C9.94238 20.1921 8.77051 19.9578 7.67676 19.489C6.59863 19.0203 5.64551 18.3796 4.81738 17.5671C4.00488 16.7546 3.36426 15.8015 2.89551 14.7078C2.42676 13.614 2.19238 12.4421 2.19238 11.1921C2.19238 9.95776 2.42676 8.7937 2.89551 7.69995C3.36426 6.6062 4.00488 5.65308 4.81738 4.84058C5.64551 4.02808 6.59863 3.38745 7.67676 2.9187C8.77051 2.43433 9.94238 2.19214 11.1924 2.19214C12.4424 2.19214 13.6064 2.43433 14.6846 2.9187C15.7783 3.38745 16.7393 4.02808 17.5674 4.84058C18.3799 5.65308 19.0205 6.6062 19.4893 7.69995C19.958 8.7937 20.1924 9.95776 20.1924 11.1921ZM7.48926 8.89526L9.78613 11.1921L7.48926 13.489C7.28613 13.6921 7.18457 13.9343 7.18457 14.2156C7.18457 14.4812 7.28613 14.7078 7.48926 14.8953C7.67676 15.0984 7.91113 15.2 8.19238 15.2C8.47363 15.2 8.70801 15.0984 8.89551 14.8953L11.1924 12.6218L13.4893 14.8953C13.6768 15.0984 13.9111 15.2 14.1924 15.2C14.4736 15.2 14.708 15.0984 14.8955 14.8953C15.0986 14.7078 15.2002 14.4812 15.2002 14.2156C15.2002 13.9343 15.0986 13.6921 14.8955 13.489L12.5986 11.1921L14.8955 8.89526C15.0986 8.70776 15.2002 8.4812 15.2002 8.21558C15.2002 7.93433 15.0986 7.69214 14.8955 7.48901C14.708 7.30151 14.4736 7.20776 14.1924 7.20776C13.9111 7.20776 13.6768 7.30151 13.4893 7.48901L11.1924 9.78589L8.89551 7.48901C8.70801 7.30151 8.47363 7.20776 8.19238 7.20776C7.91113 7.20776 7.67676 7.30151 7.48926 7.48901C7.28613 7.69214 7.18457 7.93433 7.18457 8.21558C7.18457 8.4812 7.28613 8.70776 7.48926 8.89526Z" fill="#C6C6C6"/>
        </svg>
        <div class="confirm-copy" v-if="isCopying">
          <svg
            class="checkmark"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 52 52"
          >
            <circle
              class="checkmark__circle"
              cx="26"
              cy="26"
              r="25"
              fill="none"
            />
            <path
              class="checkmark__check"
              fill="none"
              d="M14.1 27.2l7.1 7.2 16.7-16.8"
            />
          </svg>
        </div>
      </div>
    </div>
  </transition>
</template>

<script>
  import { mapMutations } from 'vuex'

  export default {
    name: 'ShareModal',
    props: {
      message: {
        type: String,
        default: '<strong>Compartilhe</strong> agora mesmo o link'
      },
      link: {
        type: String,
        required: true
      },
      button: {
        type: String,
        default: 'Copiar link'
      }
    },
    computed: {
      breakText() {
        const [host, pathname] = this.link.split('/')
        return `${host}/\n${pathname}`
      }
    },
    data: () => ({
      isCopying: false
    }),
    methods: {
      ...mapMutations({
        SET_SHARE_MODAL_DISPLAY: 'resume/SET_SHARE_MODAL_DISPLAY',
      }),
      handleClosing() {
        this.SET_SHARE_MODAL_DISPLAY(false)
      },
      async handleCopy() {
        if (navigator && navigator.clipboard && navigator.clipboard.writeText) {
          this.isCopying = true
          await navigator.clipboard.writeText(this.link);
          setTimeout(() => {
            this.isCopying = false
          }, 2500);
        }
      }
    }
  }
</script>

<style lang="scss" scoped>
  .modal-fade-enter,
  .modal-fade-leave-to {
    opacity: 0;
  }

  .modal-fade-enter-active,
  .modal-fade-leave-active {
    transition: opacity .5s ease;
  }

  .share-wrapper {
    background-color: rgba(0, 0, 0, 0.4);
    width: 100%;
    height: 100%;
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    z-index: 2;
    display: flex;
    justify-content: center;
    align-items: center;

    .share-modal {
      background: #FFFFFF;
      width: 375px;
      height: 300px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-content: center;
      border-radius: 12px;
      position: relative;
      padding: 24px;

      svg.modal-close-icon {
        position: absolute;
        top: 12px;
        right: 12px;

        &:hover {
          cursor: pointer;
        }
      }

      span {
        font-family: 'Inter';
        font-style: normal;
        font-weight: 400;
        font-size: 16px;
        line-height: 19px;
        text-align: center;
        color: #333333;

        &.message {
          margin-bottom: 20px;
        }

        &.link {
          background-color: #F2F2F2;
          margin-bottom: 50px;
          padding: 10px;
          border-radius: 12px;
          word-break: 'break-all';
          overflow: hidden;
        }

        strong {
          font-weight: 700;
        }
      }

    .copy-button {
        background-color: var(--orange);
        color: #FAFAFA;
        font-family: 'Inter';
        font-style: normal;
        font-weight: 400;
        font-size: 14px;
        line-height: 23px;
        display: flex;
        align-items: center;
        text-align: center;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 40px;
        border: 0;
        border-radius: 12px;

        svg {
          margin-left: 7.5px;
        }
      }

    .confirm-copy {
      height: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .checkmark__circle {
      stroke-dasharray: 166;
      stroke-dashoffset: 166;
      stroke-width: 2;
      stroke-miterlimit: 10;
      stroke: var(--green);
      fill: none;
      animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
    }

    .checkmark {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      display: block;
      stroke-width: 2;
      stroke: #fff;
      stroke-miterlimit: 10;
      margin: 10% auto;
      box-shadow: inset 0px 0px 0px var(--green);
      animation: fill 0.4s ease-in-out 0.4s forwards,
        scale 0.3s ease-in-out 0.9s both;
    }

    .checkmark__check {
      transform-origin: 50% 50%;
      stroke-dasharray: 48;
      stroke-dashoffset: 48;
      animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
    }

    @keyframes stroke {
      100% {
        stroke-dashoffset: 0;
      }
    }

    @keyframes scale {
      0%,
      100% {
        transform: none;
      }

      50% {
        transform: scale3d(1.1, 1.1, 1);
      }
    }

    @keyframes fill {
      100% {
        box-shadow: inset 0px 0px 0px 30px var(--green);
      }
    }    
    }
  }
</style>